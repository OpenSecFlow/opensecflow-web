---
import { getCollection } from 'astro:content';
import MainLayout from '../../../layouts/MainLayout.astro';
import SchemaLD from '../../../components/SchemaLD.astro';
import BreadcrumbList from '../../../components/schemas/BreadcrumbList.astro';
import { extractTitle, extractSummary } from '../../../utils/tutorialParser';

const siteURL = Astro.site?.toString() || 'https://opensecflow.io';
const tutorialURL = new URL('/tutorial/netdriver', siteURL).toString();

// Get all tutorials from the netdriver category
const allTutorials = await getCollection('tutorials', ({ data, id }) => {
  return id.startsWith('netdriver/');
});

// Parse tutorials to extract title and summary
const tutorials = allTutorials.map((tutorial) => {
  const title = extractTitle(tutorial.body);
  const summary = extractSummary(tutorial.body);
  const slug = tutorial.id.replace('netdriver/', '');
  
  return {
    ...tutorial,
    title,
    summary,
    slug,
    url: `/tutorial/netdriver/${slug}`,
  };
});

// Breadcrumb items
const breadcrumbItems = [
  { name: 'Home', url: '/' },
  { name: 'Tutorial', url: '/tutorial' },
  { name: 'NetDriver', url: '/tutorial/netdriver' },
];

// CollectionPage Schema for tutorial listing
const collectionPageSchema = {
  '@context': 'https://schema.org',
  '@type': 'CollectionPage',
  name: 'NetDriver Tutorials',
  description: 'Learn NetDriver with step-by-step tutorials and guides',
  url: tutorialURL,
  mainEntity: {
    '@type': 'ItemList',
    numberOfItems: tutorials.length,
    itemListElement: tutorials.map((tutorial, index) => ({
      '@type': 'ListItem',
      position: index + 1,
      item: {
        '@type': 'HowTo',
        '@id': new URL(tutorial.url, siteURL).toString(),
        name: tutorial.title,
        description: tutorial.summary,
      },
    })),
  },
};

---

<MainLayout
  title="NetDriver Tutorials - OpenSecFlow"
  description="Learn NetDriver with step-by-step tutorials and guides. Master network automation with REST APIs, session management, and command execution."
  keywords={['netdriver', 'tutorial', 'network automation', 'rest api', 'ssh', 'netdevops', 'quickstart', 'docker']}
>
  <BreadcrumbList items={breadcrumbItems} siteURL={siteURL} />
  <SchemaLD schema={collectionPageSchema} />
  <!-- Animated Background -->
  <div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
    <div class="absolute inset-0 bg-gradient-to-br from-slate-blue-50 via-white to-sky-50"></div>
    <!-- Animated SVG shapes -->
    <svg class="absolute inset-0 w-full h-full opacity-30" viewBox="0 0 1440 900" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice">
      <defs>
        <linearGradient id="tutorialGrad1" gradientUnits="userSpaceOnUse" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="rgb(92,178,214)" stop-opacity="0.3"/>
          <stop offset="100%" stop-color="rgb(81,118,151)" stop-opacity="0.2"/>
        </linearGradient>
        <linearGradient id="tutorialGrad2" gradientUnits="userSpaceOnUse" x1="100%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="rgb(18,57,104)" stop-opacity="0.25"/>
          <stop offset="100%" stop-color="rgb(65,97,133)" stop-opacity="0.15"/>
        </linearGradient>
        <linearGradient id="tutorialGrad3" gradientUnits="userSpaceOnUse" x1="50%" y1="0%" x2="50%" y2="100%">
          <stop offset="0%" stop-color="rgb(72,104,141)" stop-opacity="0.2"/>
          <stop offset="100%" stop-color="rgb(90,171,206)" stop-opacity="0.1"/>
        </linearGradient>
      </defs>
      <!-- Floating shapes -->
      <path class="tutorial-shape-1" d="M 0 200 Q 360 150 720 200 T 1440 200 L 1440 0 L 0 0 Z" fill="url(#tutorialGrad1)"/>
      <path class="tutorial-shape-2" d="M 0 700 Q 480 650 960 700 T 1920 700 L 1920 900 L 0 900 Z" fill="url(#tutorialGrad2)"/>
      <circle class="tutorial-shape-3" cx="1200" cy="300" r="200" fill="url(#tutorialGrad3)"/>
      <circle class="tutorial-shape-4" cx="200" cy="600" r="150" fill="url(#tutorialGrad1)"/>
      <path class="tutorial-shape-5" d="M 800 0 Q 900 100 1000 0 L 1000 200 Q 900 100 800 200 Z" fill="url(#tutorialGrad2)"/>
    </svg>
    <!-- Additional gradient overlay -->
    <div class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-slate-blue-50/50"></div>
  </div>

  <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="text-center mb-12">
      <h1 class="text-4xl font-bold text-navy-800 mb-4">
        NetDriver Tutorials
      </h1>
      <p class="text-lg text-slate-blue-600 max-w-2xl mx-auto">
        Step-by-step guides to master network automation with NetDriver
      </p>
    </div>

    {tutorials.length === 0 ? (
      <div class="text-center py-12">
        <p class="text-slate-blue-600">
          No tutorials available yet. Check back soon!
        </p>
      </div>
    ) : (
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {tutorials.map((tutorial) => (
          <a
            href={tutorial.url}
            class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300 border-2 border-slate-blue-200 hover:border-sky-400 transform hover:-translate-y-1 group"
          >
            <div class="p-6">
              <h2 class="text-xl font-semibold text-navy-800 mb-2 group-hover:text-sky-500 transition-colors">
                {tutorial.title}
              </h2>
              <p class="text-slate-blue-600 text-sm mb-4 line-clamp-3">
                {tutorial.summary}
              </p>
              <div class="inline-flex items-center gap-1 text-xs text-sky-600 font-medium">
                <span>Read Tutorial</span>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </div>
            </div>
          </a>
        ))}
      </div>
    )}
  </div>
</MainLayout>

<style>
  @keyframes float1 {
    0%, 100% { transform: translateY(0px) translateX(0px); }
    50% { transform: translateY(-30px) translateX(20px); }
  }
  
  @keyframes float2 {
    0%, 100% { transform: translateY(0px) translateX(0px); }
    50% { transform: translateY(-30px) translateX(20px); }
  }
  
  @keyframes float2 {
    0%, 100% { transform: translateY(0px) translateX(0px); }
    50% { transform: translateY(20px) translateX(-15px); }
  }
  
  @keyframes float3 {
    0%, 100% { transform: translateY(0px) scale(1); }
    50% { transform: translateY(-25px) scale(1.1); }
  }
  
  @keyframes float4 {
    0%, 100% { transform: translateY(0px) scale(1); }
    50% { transform: translateY(15px) scale(0.9); }
  }
  
  @keyframes float5 {
    0%, 100% { transform: translateX(0px) rotate(0deg); }
    50% { transform: translateX(30px) rotate(5deg); }
  }

  .tutorial-shape-1 {
    animation: float1 20s ease-in-out infinite;
  }
  
  .tutorial-shape-2 {
    animation: float2 25s ease-in-out infinite;
  }
  
  .tutorial-shape-3 {
    animation: float3 18s ease-in-out infinite;
  }
  
  .tutorial-shape-4 {
    animation: float4 22s ease-in-out infinite;
  }
  
  .tutorial-shape-5 {
    animation: float5 15s ease-in-out infinite;
  }

  /* Table of Contents Icons */
  .toc-list {
    list-style: none;
  }

  .toc-icon {
    font-size: 1.25rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 1.75rem;
    height: 1.75rem;
    flex-shrink: 0;
    transition: transform 0.2s ease;
  }

  .toc-sublist {
    list-style: none;
  }

  .toc-subicon {
    font-size: 1rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 1.5rem;
    height: 1.5rem;
    flex-shrink: 0;
    transition: transform 0.2s ease;
  }

</style>
